(()=>{"use strict";var t={d:(e,s)=>{for(var i in s)t.o(s,i)&&!t.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:s[i]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};t.d({},{H:()=>P});const e=320,s=document.getElementById("game"),i=s.getContext("2d"),r=new Image;r.src="assets/images/points.png";const a=new Image;a.src="assets/images/dttsString.png";const h=new Image;h.src="assets/images/StringBEST.png";const n=new Image;n.src="assets/images/HitString.png";class c{drawStart(){P.topBotSpikes.draw(),P.bird.draw(),i.fillStyle="#aaa",i.font="bold 30px Arial",i.drawImage(a,0,0,873,240,30,70,873/3.2,75),i.drawImage(h,0,0,614,155,60,330,191.875,48.4375),i.drawImage(n,0,0,111,57,105,170,111,57),i.fillText(P.score.getBestScore().toString(),267,350),i.fillText(P.score.getGamesPlayed().toString(),267,377)}drawGame(){P.sideSpikes.draw(),P.candy.draw();const t=new Path2D;t.arc(160,220,65,0,2*Math.PI,!1),i.fillStyle="white",i.fill(t),i.lineWidth=10,i.strokeStyle="white",i.stroke(t),i.fillStyle="#ebebeb",i.font="bold 70px Arial",P.score.getScore()<10?i.fillText(P.score.getScore().toString(),142,240):P.score.getScore()>=10&&P.score.getScore()<100?i.fillText(P.score.getScore().toString(),122,240):P.score.getScore()>=100&&i.fillText(P.score.getScore().toString(),105,240),P.bird.draw()}drawEnd(){P.topBotSpikes.draw(),i.fillStyle="#aaa",i.font="bold 30px Arial",i.drawImage(a,0,0,873,240,30,70,873/3.2,75),i.drawImage(h,0,0,614,155,60,330,191.875,48.4375),i.drawImage(r,0,0,900,800,65,180,220,180),i.fillStyle="#ebebeb";const t=P.score.getScore()+3*P.score.getCandy();t<10?i.fillText(t.toString(),155,210):t>=10&&t<100?i.fillText(t.toString(),150,210):t>=100&&i.fillText(t.toString(),145,210),i.fillStyle="#aaa",i.fillText(P.score.getBestScore().toString(),267,350),i.fillText(P.score.getGamesPlayed().toString(),267,377),P.collision.checkCandyCollided=!1}}const o=new Image;o.src="assets/images/bird1.png";const d=new Image;d.src="assets/images/bird2.png";class l{constructor(){if(this.constructor==l)throw new Error("Abstract classes can't be instantiated.")}}class g extends l{constructor(){super(),this.draw=()=>{2==this.direction?i.drawImage(this.image,0,0,this.w,this.h,this.x,this.y,this.w/3.2,this.h/3.2):1==this.direction&&(i.save(),i.translate(this.x,this.y),i.scale(-1,1),i.drawImage(this.image,0,0,this.w,this.h,-45,0,this.w/3.2,this.h/3.2),i.restore())},this.update=()=>{if(1==P.state.current)this.y+=.1,Math.abs(this.y-240)>=10&&(this.y=240);else if(3==P.state.current)this.y=285;else{this.speed-=this.gravity,this.y-=this.speed,this.speed<=0&&(this.image=o),this.x+=2==this.direction?this.vx:-this.vx,P.collision.checkWallCollision(),P.collision.checkOutOfBounds(),P.collision.checkHitCandy();for(const t of P.sideSpikes.getSpikes())P.collision.checkHitSpike(t.getY())}},this.flap=()=>{this.speed=this.jump,this.image=d},this.reset=()=>{this.x=140,this.y=190,this.speed=0,this.direction=2},this.w=156,this.h=101,this.x=140,this.y=240,this.speed=0,this.jump=3,this.gravity=.15,this.vx=2,this.image=d,this.direction=2}getX(){return this.x}getY(){return this.y}getW(){return this.w}getH(){return this.h}getDirection(){return this.direction}setDirection(t){this.direction=t}}const w=new Image;w.src="assets/images/candy.png";class u{constructor(){if(this.constructor==u)throw new Error("Abstract classes can't be instantiated.")}}class p extends u{constructor(){super(),this.w=118,this.h=70,this.x=0,this.y=0}getX(){return this.x}getY(){return this.y}getW(){return this.w}getH(){return this.h}draw(){const t=P.sideSpikes.getSpikes()[2];P.collision.checkCandyCollided&&(this.x=-40,i.drawImage(w,0,0,this.w,this.h,-10,-100,this.w/3.35,this.h/3.35)),t.y>0&&!P.collision.checkCandyCollided&&(1==P.bird.getDirection()?this.x=t.x-50:this.x=e-(t.x-5),this.y=t.y-15,i.drawImage(w,0,0,this.w,this.h,this.x,this.y,this.w/3.35,this.h/3.35))}update(){console.log(this.x,this.y),P.score.updateCandy()}}class b{constructor(){this.checkCandyCollided=!1,this.checkWallCollision=()=>{const t=P.score.getScore();2==P.bird.getDirection()&&Math.floor(P.bird.getX())>=e-Math.floor(P.bird.getW()/3.2)&&(P.bird.setDirection(1),P.score.setScore(t+1),P.sideSpikes.update(),this.checkCandyCollided=!1),1==P.bird.getDirection()&&Math.floor(P.bird.getX())<=0&&(P.bird.setDirection(2),P.score.setScore(t+1),P.sideSpikes.update(),this.checkCandyCollided=!1)},this.checkOutOfBounds=()=>{(P.bird.getY()<Math.floor(P.bird.getW()/3.2)||P.bird.getY()>480-Math.floor(P.bird.getW()/3.2)-50)&&P.score.gameOver()},this.checkInsideTriangle=(t,e)=>{const[s,i,r]=e,a=(i[1]-r[1])*(s[0]-r[0])+(r[0]-i[0])*(s[1]-r[1]),h=((i[1]-r[1])*(t[0]-r[0])+(r[0]-i[0])*(t[1]-r[1]))/a,n=((r[1]-s[1])*(t[0]-r[0])+(s[0]-r[0])*(t[1]-r[1]))/a;return h>=0&&n>=0&&1-h-n>=0},this.checkHitSpike=t=>{const[e,s,i]=[P.bird.getX(),P.bird.getY(),69];let r,a,h;2==P.bird.getDirection()?(r=[317,t+12],a=[317,t+i/2-18],h=[295.4375,t+i/8+18],(this.checkInsideTriangle([e+P.bird.getW()/3.2,s],[r,a,h])||this.checkInsideTriangle([e+P.bird.getW()/3.2,s+P.bird.getH()/3.1],[r,a,h])||this.checkInsideTriangle([e+P.bird.getW()/3.2,(s+s+P.bird.getH()/3.1)/2],[r,a,h]))&&P.score.gameOver()):(r=[0,t+12],a=[0,t+i/2-18],h=[21,t+i/8+18],(this.checkInsideTriangle([e,s],[r,a,h])||this.checkInsideTriangle([e,s+P.bird.getH()/3.1],[r,a,h])||this.checkInsideTriangle([e,(P.bird.getY()+P.bird.getY()+P.bird.getH()/3.1)/2],[r,a,h]))&&P.score.gameOver())},this.checkHitCandy=()=>{const[t,s]=[P.bird.getX(),P.bird.getY()],[i,r,a,h]=[P.candy.getX(),P.candy.getY(),P.candy.getW(),P.candy.getH()];(t>=i&&t<=i+a-80&&s>=r&&s<=r+h||t>=e-i+140&&t<=e-i+140+a&&s>=r&&s<=r+h)&&(this.checkCandyCollided||(this.checkCandyCollided=!0,P.candy.update()))}}}class y{constructor(){if(this.constructor==y)throw new Error("Abstract classes can't be instantiated.")}}class m extends y{constructor(){super(),this.bestScore=0,this.gamesPlayed=0,this.candyCount=0,this.score=0}setScore(t){this.score=t}getScore(){return this.score}updateCandy(){this.candyCount++}getCandy(){return this.candyCount}getBestScore(){return this.bestScore}getGamesPlayed(){return this.gamesPlayed}reset(){this.candyCount=0,this.score=0}gameOver(){P.state.current=3,this.bestScore=Math.max(this.score+3*this.candyCount,this.bestScore),this.gamesPlayed++,P.bird.reset()}}const S=new Image;S.src="assets/images/spike.png";class k{}class f extends k{constructor(){super(),this.draw=()=>{2==P.bird.getDirection()?i.drawImage(S,0,0,this.w,this.h,298,this.y,this.w/2,this.h/2):1==P.bird.getDirection()&&(i.save(),i.translate(0,this.y),i.scale(-1,1),i.drawImage(S,0,0,this.w,this.h,-22,0,this.w/2,this.h/2),i.restore())},this.w=69,this.h=116,this.x=70,this.y=-70}setY(t){this.y=t}getY(){return this.y}getH(){return this.h}getW(){return this.w}}class x{}class I extends x{constructor(){super(),this.reset=()=>{this.length=3,this.spikes=[];for(let t=0;t<this.length;t++)this.spikes.push(new f)},this.length=3,this.spikes=[];for(let t=0;t<this.length;t++)this.spikes.push(new f)}genRandom(){let t=0,e=0;for(;0===t;)t=Math.random();for(;0===e;)e=Math.random();let s=Math.sqrt(-2*Math.log(t))*Math.cos(2*Math.PI*e);return s=s/10+.5,s>1||s<0?this.genRandom():s}getSpikes(){return this.spikes}draw(){for(let t=0;t<this.length;t++)this.spikes[t].draw()}update(){P.score.getScore()>0&&P.score.getScore()%5==0&&this.spikes.push(new f);const t=290/this.length;for(let e=0;e<this.length;e++){const s=Math.floor(this.genRandom()*t+90+t*e)+20;s>=90&&s<380&&this.spikes[e].setY(s)}}}class C{}class T extends C{constructor(){super(),this.current=1}drawStart(){1==P.state.current&&P.background.drawStart()}drawGame(){2==P.state.current&&P.background.drawGame()}drawEnd(){3==P.state.current&&P.background.drawEnd()}updateGameState(t){if(1==P.state.current)P.score.setScore(0),P.state.current=2;else if(2==P.state.current)P.bird.flap();else{P.bird.reset(),P.sideSpikes.reset();const e=s.getBoundingClientRect(),r=t.clientX-e.left,a=t.clientY-e.top,h=new Path2D;h.rect(70,245,200,30),h.closePath(),i.fillStyle="#FFFFFF",i.fillStyle="rgba(225,225,225,0.5)",i.fill(h),i.isPointInPath(h,r,a)&&(P.state.current=1,P.score.reset(),P.collision.checkCandyCollided=!1)}}}const Y=new Image;Y.src="assets/images/spikes.png";class M{constructor(){this.w=1080,this.h=218,this.topX=0,this.topY=0,this.botX=337.5,this.botY=480}draw(){i.drawImage(Y,0,0,this.w,this.h,this.topX,this.topY,this.w/3.2,this.h/3.2),i.save(),i.translate(0,0),i.rotate(180*Math.PI/180),i.drawImage(Y,0,0,this.w,this.h,-this.botX,-this.botY,this.w/3.2,this.h/3.2),i.restore()}update(){alert("Not implemented")}}const P=new class{constructor(){this.bird=new g,this.score=new m,this.candy=new p,this.topBotSpikes=new M,this.sideSpikes=new I,this.background=new c,this.collision=new b,this.state=new T}draw(){i.fillStyle="#ebebeb",i.fillRect(0,0,e,480),this.topBotSpikes.draw(),this.state.drawStart(),this.state.drawGame(),this.state.drawEnd()}update(){this.bird.update(),document.addEventListener("click",(function(t){P.state.updateGameState(t)}))}};!function t(){P.draw(),P.update(),requestAnimationFrame(t)}()})();