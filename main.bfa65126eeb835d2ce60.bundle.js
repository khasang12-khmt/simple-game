(()=>{"use strict";const t=320,e=document.getElementById("game"),s=e.getContext("2d");var i;class r{}i=r,r.checkCandyCollided=!1,r.checkWallCollision=()=>{const e=H.score.getScore();2==H.bird.getDirection()&&Math.floor(H.bird.getX())>=t-Math.floor(H.bird.getW()/3.2)&&(H.bird.setDirection(1),H.score.setScore(e+1),H.sideSpikes.update(),i.checkCandyCollided=!1),1==H.bird.getDirection()&&Math.floor(H.bird.getX())<=0&&(H.bird.setDirection(2),H.score.setScore(e+1),H.sideSpikes.update(),i.checkCandyCollided=!1)},r.checkOutOfBounds=()=>{(H.bird.getY()<Math.floor(H.bird.getW()/3.2)||H.bird.getY()>480-Math.floor(H.bird.getW()/3.2)-50)&&H.score.gameOver()},r.checkInsideTriangle=(t,e)=>{const[s,i,r]=e,a=(i[1]-r[1])*(s[0]-r[0])+(r[0]-i[0])*(s[1]-r[1]),c=((i[1]-r[1])*(t[0]-r[0])+(r[0]-i[0])*(t[1]-r[1]))/a,n=((r[1]-s[1])*(t[0]-r[0])+(s[0]-r[0])*(t[1]-r[1]))/a;return c>=0&&n>=0&&1-c-n>=0},r.checkHitSpike=t=>{const[e,s,r]=[H.bird.getX(),H.bird.getY(),69];let a,c,n;2==H.bird.getDirection()?(a=[317,t+12],c=[317,t+r/2-18],n=[295.4375,t+r/8+18],(i.checkInsideTriangle([e+H.bird.getW()/3.2,s],[a,c,n])||i.checkInsideTriangle([e+H.bird.getW()/3.2,s+H.bird.getH()/3.1],[a,c,n])||i.checkInsideTriangle([e+H.bird.getW()/3.2,(s+s+H.bird.getH()/3.1)/2],[a,c,n]))&&H.score.gameOver()):(a=[0,t+12],c=[0,t+r/2-18],n=[21,t+r/8+18],(i.checkInsideTriangle([e,s],[a,c,n])||i.checkInsideTriangle([e,s+H.bird.getH()/3.1],[a,c,n])||i.checkInsideTriangle([e,(H.bird.getY()+H.bird.getY()+H.bird.getH()/3.1)/2],[a,c,n]))&&H.score.gameOver())},r.checkHitCandy=()=>{const[e,s]=[H.bird.getX(),H.bird.getY()],[r,a,c,n]=[H.candy.getX(),H.candy.getY(),H.candy.getW(),H.candy.getH()];(e>=r&&e<=r+c-80&&s>=a&&s<=a+n||e>=t-r+140&&e<=t-r+140+c&&s>=a&&s<=a+n)&&(i.checkCandyCollided||(i.checkCandyCollided=!0,H.candy.update()))},r.drawBoundBox=t=>{s.fillStyle="red",s.fillRect(0,t+12,4,-4),s.fillRect(0,t+H.sideSpikes.getSpikes()[0].getH()/2-18,4,4),s.fillRect(0+H.sideSpikes.getSpikes()[0].getW()/3-2,t+H.sideSpikes.getSpikes()[0].getH()/8+18,4,-4),s.fillRect(317,t+H.sideSpikes.getSpikes()[0].getH()/2-18,4,-4),s.fillRect(317,t+12,4,4),s.fillRect(317-H.sideSpikes.getSpikes()[0].getW()/3.2,t+H.sideSpikes.getSpikes()[0].getH()/8+18,4,-4),s.fillStyle="green",s.fillRect(H.bird.getX()+H.bird.getW()/3.2,H.bird.getY(),4,4),s.fillRect(H.bird.getX()+H.bird.getW()/3.2,H.bird.getY()+H.bird.getH()/3.1,4,-4),s.fillRect(H.bird.getX(),H.bird.getY(),4,-4),s.fillRect(H.bird.getX(),H.bird.getY()+H.bird.getH()/3.1,4,4),s.fillStyle="yellow",s.fillRect(H.candy.getX()+H.candy.getW()/3.2,H.candy.getY(),4,4),s.fillRect(H.candy.getX()+H.candy.getW()/3.2,H.candy.getY()+H.candy.getH()/3.1,4,-4),s.fillRect(H.candy.getX(),H.candy.getY(),4,-4),s.fillRect(H.candy.getX(),H.candy.getY()+H.candy.getH()/3.1,4,4)};const a=new Image;a.src="assets/images/bird1.png";const c=new Image;c.src="assets/images/bird2.png";class n{constructor(){if(this.constructor==n)throw new Error("Abstract classes can't be instantiated.")}getX(){return this.x}getY(){return this.y}getW(){return this.w}getH(){return this.h}getFrame(){return this.frame}setFrame(t){this.frame=t}getDirection(){return this.direction}setDirection(t){this.direction=t}}class h extends n{constructor(){super(),this.flap=()=>{this.speed=this.jump,this.image=c},this.reset=()=>{this.x=140,this.y=190,this.speed=0,this.direction=2},this.w=156,this.h=101,this.x=140,this.y=240,this.frame=0,this.speed=0,this.jump=3,this.gravity=.15,this.vx=2,this.image=c,this.direction=2}draw(){2==this.direction?s.drawImage(this.image,0,0,this.w,this.h,this.x,this.y,this.w/3.2,this.h/3.2):1==this.direction&&(s.save(),s.translate(this.x,this.y),s.scale(-1,1),s.drawImage(this.image,0,0,this.w,this.h,-45,0,this.w/3.2,this.h/3.2),s.restore())}update(){if(1==H.state.current)this.y+=.1,Math.abs(this.y-240)>=10&&(this.y=240);else if(3==H.state.current)this.y=285;else{this.speed-=this.gravity,this.y-=this.speed*this.frame/16,this.speed<=0&&(this.image=a),this.x+=2==this.direction?this.vx:-this.vx,r.checkWallCollision(),r.checkOutOfBounds(),r.checkHitCandy();for(const t of H.sideSpikes.getSpikes())r.checkHitSpike(t.getY())}}}const d=new Image;d.src="assets/images/candy.png";class o{getX(){return this.x}getY(){return this.y}getW(){return this.w}getH(){return this.h}constructor(){if(this.constructor==o)throw new Error("Abstract classes can't be instantiated.")}}class l extends o{constructor(){super(),this.w=118,this.h=70,this.x=0,this.y=-70}draw(){const e=H.sideSpikes.getSpikes()[2];r.checkCandyCollided&&(this.x=-40,s.drawImage(d,0,0,this.w,this.h,-10,-100,this.w/3.35,this.h/3.35)),e.getY()>0&&!r.checkCandyCollided&&(1==H.bird.getDirection()?this.x=e.getX()-50:this.x=t-(e.getX()-5),this.y=e.getY()-15,s.drawImage(d,0,0,this.w,this.h,this.x,this.y,this.w/3.35,this.h/3.35))}update(){H.score.updateCandy()}}class g{constructor(){if(this.constructor==g)throw new Error("Abstract classes can't be instantiated.")}}class p extends g{constructor(){super(),this.bestScore=0,this.gamesPlayed=0,this.candyCount=0,this.score=0}setScore(t){this.score=t}getScore(){return this.score}updateCandy(){this.candyCount++}getCandy(){return this.candyCount}getBestScore(){return this.bestScore}getGamesPlayed(){return this.gamesPlayed}reset(){this.candyCount=0,this.score=0}gameOver(){H.state.current=3,this.bestScore=Math.max(this.score+3*this.candyCount,this.bestScore),this.gamesPlayed++,H.bird.reset()}}class w{getH(){return this.h}getW(){return this.w}setY(t){this.y=t}getY(){return this.y}setX(t){this.x=t}getX(){return this.x}draw(){alert("Not implemented")}update(){alert("Not implemented")}}const u=new Image;u.src="assets/images/spike.png";class S extends w{constructor(){super(),this.w=69,this.h=116,this.x=70,this.y=-70}draw(){2==H.bird.getDirection()?s.drawImage(u,0,0,this.w,this.h,298,this.y,this.w/2,this.h/2):1==H.bird.getDirection()&&(s.save(),s.translate(0,this.y),s.scale(-1,1),s.drawImage(u,0,0,this.w,this.h,-22,0,this.w/2,this.h/2),s.restore())}update(){alert("Not implemented")}}class m{constructor(){this.reset=()=>{this.length=3,this.spikes=[];for(let t=0;t<this.length;t++)this.spikes.push(new S)},this.length=3,this.spikes=[];for(let t=0;t<this.length;t++)this.spikes.push(new S)}genRandom(){let t=0,e=0;for(;0===t;)t=Math.random();for(;0===e;)e=Math.random();let s=Math.sqrt(-2*Math.log(t))*Math.cos(2*Math.PI*e);return s=s/10+.5,s>1||s<0?this.genRandom():s}getSpikes(){return this.spikes}draw(){for(let t=0;t<this.length;t++)this.spikes[t].draw()}update(){H.score.getScore()>0&&H.score.getScore()%5==0&&this.spikes.push(new S);const t=290/this.length;for(let e=0;e<this.length;e++){const s=Math.floor(this.genRandom()*t+90+t*e)+20;s>=90&&s<380&&this.spikes[e].setY(s)}}}const y=new Image;y.src="assets/images/points.png";const b=new Image;b.src="assets/images/dttsString.png";const f=new Image;f.src="assets/images/StringBEST.png";const k=new Image;k.src="assets/images/HitString.png";class x{static drawStart(){H.topBotSpikes.draw(),H.bird.draw(),s.fillStyle="#aaa",s.font="bold 30px Arial",s.drawImage(b,0,0,873,240,30,70,873/3.2,75),s.drawImage(f,0,0,614,155,60,330,191.875,48.4375),s.drawImage(k,0,0,111,57,105,170,111,57),s.fillText(H.score.getBestScore().toString(),267,350),s.fillText(H.score.getGamesPlayed().toString(),267,377)}static drawGame(){H.sideSpikes.draw(),H.candy.draw();const t=new Path2D;t.arc(160,220,65,0,2*Math.PI,!1),s.fillStyle="white",s.fill(t),s.lineWidth=10,s.strokeStyle="white",s.stroke(t),s.fillStyle="#ebebeb",s.font="bold 70px Arial",H.score.getScore()<10?s.fillText(H.score.getScore().toString(),142,240):H.score.getScore()>=10&&H.score.getScore()<100?s.fillText(H.score.getScore().toString(),122,240):H.score.getScore()>=100&&s.fillText(H.score.getScore().toString(),105,240),H.bird.draw()}static drawEnd(){H.topBotSpikes.draw(),s.fillStyle="#aaa",s.font="bold 30px Arial",s.drawImage(b,0,0,873,240,30,70,873/3.2,75),s.drawImage(f,0,0,614,155,60,330,191.875,48.4375),s.drawImage(y,0,0,900,800,65,180,220,180),s.fillStyle="#ebebeb";const t=H.score.getScore()+3*H.score.getCandy();t<10?s.fillText(t.toString(),155,210):t>=10&&t<100?s.fillText(t.toString(),150,210):t>=100&&s.fillText(t.toString(),145,210),s.fillStyle="#aaa",s.fillText(H.score.getBestScore().toString(),267,350),s.fillText(H.score.getGamesPlayed().toString(),267,377),r.checkCandyCollided=!1}}class I{}class C extends I{constructor(){super(),this.current=1}drawStart(){1==H.state.current&&x.drawStart()}drawGame(){2==H.state.current&&x.drawGame()}drawEnd(){3==H.state.current&&x.drawEnd()}updateGameState(t){if(1==H.state.current)H.score.setScore(0),H.state.current=2;else if(2==H.state.current)H.bird.flap();else{H.bird.reset(),H.sideSpikes.reset();const i=e.getBoundingClientRect(),a=t.clientX-i.left,c=t.clientY-i.top,n=new Path2D;n.rect(70,245,200,30),n.closePath(),s.fillStyle="#FFFFFF",s.fillStyle="rgba(225,225,225,0.5)",s.fill(n),s.isPointInPath(n,a,c)&&(H.state.current=1,H.score.reset(),r.checkCandyCollided=!1)}}}const Y=new Image;Y.src="assets/images/spikes.png";class X extends w{constructor(){super(),this.w=1080,this.h=218,this.topX=0,this.topY=0,this.botX=337.5,this.botY=480}draw(){s.drawImage(Y,0,0,this.w,this.h,this.topX,this.topY,this.w/3.2,this.h/3.2),s.save(),s.translate(0,0),s.rotate(180*Math.PI/180),s.drawImage(Y,0,0,this.w,this.h,-this.botX,-this.botY,this.w/3.2,this.h/3.2),s.restore()}update(){alert("Not implemented")}}const H=new class{constructor(){this.bird=new h,this.score=new p,this.candy=new l,this.topBotSpikes=new X,this.sideSpikes=new m,this.state=new C}draw(){s.fillStyle="#ebebeb",s.fillRect(0,0,t,480),this.topBotSpikes.draw(),this.state.drawStart(),this.state.drawGame(),this.state.drawEnd()}update(t){this.bird.setFrame(t),this.bird.update(),document.addEventListener("click",(function(t){H.state.updateGameState(t)}))}};!function t(e){const s=Date.now();H.draw(),H.update(s-e),e=Date.now(),requestAnimationFrame((()=>t(e)))}(Date.now())})();