(()=>{"use strict";var t={d:(e,s)=>{for(var i in s)t.o(s,i)&&!t.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:s[i]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};t.d({},{H:()=>M});const e=document.getElementById("game"),s=e.getContext("2d"),i=new Image;i.src="assets/images/points.png";const r=new Image;r.src="assets/images/dttsString.png";const a=new Image;a.src="assets/images/StringBEST.png";const h=new Image;h.src="assets/images/HitString.png";class n{drawStart(){M.topBotSpikes.draw(),M.bird.draw(),s.fillStyle="#aaa",s.font="bold 30px Arial",s.drawImage(r,0,0,873,240,30,70,873/3.2,75),s.drawImage(a,0,0,614,155,60,330,191.875,48.4375),s.drawImage(h,0,0,111,57,105,170,111,57),s.fillText(M.score.getBestScore().toString(),267,350),s.fillText(M.score.getGamesPlayed().toString(),267,377)}drawGame(){M.sideSpikes.draw(),M.candy.draw();const t=new Path2D;t.arc(160,220,65,0,2*Math.PI,!1),s.fillStyle="white",s.fill(t),s.lineWidth=10,s.strokeStyle="white",s.stroke(t),s.fillStyle="#ebebeb",s.font="bold 70px Arial",M.score.getScore()<10?s.fillText(M.score.getScore().toString(),142,240):M.score.getScore()>=10&&M.score.getScore()<100?s.fillText(M.score.getScore().toString(),122,240):M.score.getScore()>=100&&s.fillText(M.score.getScore().toString(),105,240),M.bird.draw()}drawEnd(){M.topBotSpikes.draw(),s.fillStyle="#aaa",s.font="bold 30px Arial",s.drawImage(r,0,0,873,240,30,70,873/3.2,75),s.drawImage(a,0,0,614,155,60,330,191.875,48.4375),s.drawImage(i,0,0,900,800,65,180,220,180),s.fillStyle="#ebebeb";const t=M.score.getScore()+3*M.score.getCandy();t<10?s.fillText(t.toString(),155,210):t>=10&&t<100?s.fillText(t.toString(),150,210):t>=100&&s.fillText(t.toString(),145,210),s.fillStyle="#aaa",s.fillText(M.score.getBestScore().toString(),267,350),s.fillText(M.score.getGamesPlayed().toString(),267,377),M.collision.checkCandyCollided=!1}}const c=new Image;c.src="assets/images/bird1.png";const o=new Image;o.src="assets/images/bird2.png";class d{constructor(){if(this.constructor==d)throw new Error("Abstract classes can't be instantiated.")}}class l extends d{constructor(){super(),this.draw=()=>{2==this.direction?s.drawImage(this.image,0,0,this.w,this.h,this.x,this.y,this.w/3.2,this.h/3.2):1==this.direction&&(s.save(),s.translate(this.x,this.y),s.scale(-1,1),s.drawImage(this.image,0,0,this.w,this.h,-45,0,this.w/3.2,this.h/3.2),s.restore())},this.update=()=>{if(1==M.state.current)this.y+=.1,Math.abs(this.y-240)>=10&&(this.y=240);else if(3==M.state.current)this.y=285;else{this.speed-=this.gravity,this.y-=this.speed,this.speed<=0&&(this.image=c),this.x+=2==this.direction?this.vx:-this.vx,M.collision.checkWallCollision(),M.collision.checkOutOfBounds(),M.collision.checkHitCandy();for(const t of M.sideSpikes.getSpikes())M.collision.checkHitSpike(t.getY())}},this.flap=()=>{this.speed=this.jump,this.image=o},this.reset=()=>{this.x=140,this.y=190,this.speed=0,this.direction=2},this.w=156,this.h=101,this.x=140,this.y=240,this.speed=0,this.jump=3,this.gravity=.15,this.vx=2,this.image=o,this.direction=2}getX(){return this.x}getY(){return this.y}getW(){return this.w}getH(){return this.h}getDirection(){return this.direction}setDirection(t){this.direction=t}}const g=new Image;g.src="assets/images/candy.png";class w{constructor(){if(this.constructor==w)throw new Error("Abstract classes can't be instantiated.")}}class u extends w{constructor(){super(),this.w=118,this.h=70,this.x=0,this.y=0}getX(){return this.x}getY(){return this.y}getW(){return this.w}getH(){return this.h}draw(){const t=M.sideSpikes.getSpikes()[2];t.y>0&&!M.collision.checkCandyCollided&&(1==M.bird.getDirection()?this.x=t.x-50:this.x=320-(t.x+10),this.y=t.y-15,s.drawImage(g,0,0,this.w,this.h,this.x,this.y,this.w/3.35,this.h/3.35))}update(){M.score.updateCandy()}}class p{constructor(){this.checkCandyCollided=!1,this.checkWallCollision=()=>{const t=M.score.getScore();2==M.bird.getDirection()&&Math.floor(M.bird.getX())>=320-Math.floor(M.bird.getW()/3.2)&&(M.bird.setDirection(1),M.score.setScore(t+1),M.sideSpikes.update(),this.checkCandyCollided=!1),1==M.bird.getDirection()&&Math.floor(M.bird.getX())<=0&&(M.bird.setDirection(2),M.score.setScore(t+1),M.sideSpikes.update(),this.checkCandyCollided=!1)},this.checkOutOfBounds=()=>{(M.bird.getY()<Math.floor(M.bird.getW()/3.2)||M.bird.getY()>480-Math.floor(M.bird.getW()/3.2)-50)&&M.score.gameOver()},this.checkInsideTriangle=(t,e)=>{const[s,i,r]=e,a=(i[1]-r[1])*(s[0]-r[0])+(r[0]-i[0])*(s[1]-r[1]),h=((i[1]-r[1])*(t[0]-r[0])+(r[0]-i[0])*(t[1]-r[1]))/a,n=((r[1]-s[1])*(t[0]-r[0])+(s[0]-r[0])*(t[1]-r[1]))/a;return h>=0&&n>=0&&1-h-n>=0},this.checkHitSpike=t=>{const[e,s,i]=[M.bird.getX(),M.bird.getY(),69];let r,a,h;2==M.bird.getDirection()?(r=[317,t+12],a=[317,t+i/2-18],h=[295.4375,t+i/8+18],(this.checkInsideTriangle([e+M.bird.getW()/3.2,s],[r,a,h])||this.checkInsideTriangle([e+M.bird.getW()/3.2,s+M.bird.getH()/3.1],[r,a,h])||this.checkInsideTriangle([e+M.bird.getW()/3.2,(s+s+M.bird.getH()/3.1)/2],[r,a,h]))&&M.score.gameOver()):(r=[0,t+12],a=[0,t+i/2-18],h=[21,t+i/8+18],(this.checkInsideTriangle([e,s],[r,a,h])||this.checkInsideTriangle([e,s+M.bird.getH()/3.1],[r,a,h])||this.checkInsideTriangle([e,(M.bird.getY()+M.bird.getY()+M.bird.getH()/3.1)/2],[r,a,h]))&&M.score.gameOver())},this.checkHitCandy=()=>{const[t,e]=[M.bird.getX(),M.bird.getY()],[s,i,r,a]=[M.candy.getX(),M.candy.getY(),M.candy.getW(),M.candy.getH()];t>=s&&t<=s+r-80&&e>=i&&e<=i+a&&(this.checkCandyCollided||(this.checkCandyCollided=!0,M.candy.update()))}}}class b{constructor(){if(this.constructor==b)throw new Error("Abstract classes can't be instantiated.")}}class m extends b{constructor(){super(),this.bestScore=0,this.gamesPlayed=0,this.candyCount=0,this.score=0}setScore(t){this.score=t}getScore(){return this.score}updateCandy(){this.candyCount++}getCandy(){return this.candyCount}getBestScore(){return this.bestScore}getGamesPlayed(){return this.gamesPlayed}reset(){this.candyCount=0,this.score=0}gameOver(){M.state.current=3,this.bestScore=Math.max(this.score+3*this.candyCount,this.bestScore),this.gamesPlayed++,M.bird.reset()}}const y=new Image;y.src="assets/images/spike.png";class S{}class f extends S{constructor(){super(),this.draw=()=>{2==M.bird.getDirection()?s.drawImage(y,0,0,this.w,this.h,298,this.y,this.w/2,this.h/2):1==M.bird.getDirection()&&(s.save(),s.translate(0,this.y),s.scale(-1,1),s.drawImage(y,0,0,this.w,this.h,-22,0,this.w/2,this.h/2),s.restore())},this.w=69,this.h=116,this.x=70,this.y=-70}setY(t){this.y=t}getY(){return this.y}getH(){return this.h}getW(){return this.w}}class k{}class x extends k{constructor(){super(),this.reset=()=>{this.length=3,this.spikes=[];for(let t=0;t<this.length;t++)this.spikes.push(new f)},this.length=3,this.spikes=[];for(let t=0;t<this.length;t++)this.spikes.push(new f)}genRandom(){let t=0,e=0;for(;0===t;)t=Math.random();for(;0===e;)e=Math.random();let s=Math.sqrt(-2*Math.log(t))*Math.cos(2*Math.PI*e);return s=s/10+.5,s>1||s<0?this.genRandom():s}getSpikes(){return this.spikes}draw(){for(let t=0;t<this.length;t++)this.spikes[t].draw()}update(){M.score.getScore()>0&&M.score.getScore()%5==0&&this.spikes.push(new f);const t=290/this.length;for(let e=0;e<this.length;e++){const s=Math.floor(this.genRandom()*t+90+t*e)+20;s>=90&&s<380&&this.spikes[e].setY(s)}}}class I{}class C extends I{constructor(){super(),this.current=1}drawStart(){1==M.state.current&&M.background.drawStart()}drawGame(){2==M.state.current&&M.background.drawGame()}drawEnd(){3==M.state.current&&M.background.drawEnd()}updateGameState(t){if(1==M.state.current)M.score.setScore(0),M.state.current=2;else if(2==M.state.current)M.bird.flap();else{M.bird.reset(),M.sideSpikes.reset();const i=e.getBoundingClientRect(),r=t.clientX-i.left,a=t.clientY-i.top,h=new Path2D;h.rect(70,245,200,30),h.closePath(),s.fillStyle="#FFFFFF",s.fillStyle="rgba(225,225,225,0.5)",s.fill(h),s.isPointInPath(h,r,a)&&(M.state.current=1,M.score.reset())}}}const T=new Image;T.src="assets/images/spikes.png";class Y{constructor(){this.w=1080,this.h=218,this.topX=0,this.topY=0,this.botX=337.5,this.botY=480}draw(){s.drawImage(T,0,0,this.w,this.h,this.topX,this.topY,this.w/3.2,this.h/3.2),s.save(),s.translate(0,0),s.rotate(180*Math.PI/180),s.drawImage(T,0,0,this.w,this.h,-this.botX,-this.botY,this.w/3.2,this.h/3.2),s.restore()}update(){alert("Not implemented")}}const M=new class{constructor(){this.bird=new l,this.score=new m,this.candy=new u,this.topBotSpikes=new Y,this.sideSpikes=new x,this.background=new n,this.collision=new p,this.state=new C}draw(){s.fillStyle="#ebebeb",s.fillRect(0,0,320,480),this.topBotSpikes.draw(),this.state.drawStart(),this.state.drawGame(),this.state.drawEnd()}update(){this.bird.update(),document.addEventListener("click",(function(t){M.state.updateGameState(t)}))}};!function t(){M.draw(),M.update(),requestAnimationFrame(t)}()})();